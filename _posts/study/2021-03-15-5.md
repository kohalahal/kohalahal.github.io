---
layout: post
title: 컴퓨터의 중앙 처리 장치 CPU
categories : study
---

### CPU의 기능
CPU는 프로그램을 실행한다.
프로그램은 명령어(instruction)라고 부르는 연산의 묶음들로 되어있다. 연산이 더하기나 빼기라면 CPU는 ALU에게 수학 연산을 하도록 설정할 것이다.

CPU에는 많은 부품이 있다. 두 부품을 한 선으로 연결하는 것 또한 추상화이다.  이러한 고수준 접근을 마이크로 아키텍쳐라고 한다.

### CPU의 구성 예시

-8비트 REGISTER 네개  
-컨트롤 유닛
    명렁어 주소 레지스터-프로그램 중 어디에 있는지 추적하기 위해 명령어의 메모리 주소를 저장.  
    명령어 레지스터-현재 명령어를 저장.
-ALU  
-클럭

### CPU의 동작 에시
다른 데이터와 마찬가지로 프로그램도 이진수로 메모리에 저장된다. 명령어는 4비트 연산코드, 그리고 4비트의 램 혹은 레지스터 주소를 보낸다.

CPU는 첫 동작 단계는 FETCH PHASE다. 첫 명령어를 가져오는 것이다. 명령어 주소에 있는 레지스터의 주소에서 명령어를 가져온다. 명령어는 명령어 레지스터에 저장된다.  

다음 동작 단계는 DECODE PHASE이다. 명령어 레지스터의 명령을 디코드하는 회로를 거친다. (예시 명령어:1110의 데이터 로드해서 A에 저장하라.)

다음 동작 단계는 EXECUTE PHASE이다. 명령어 레지스터에 저장된 메모리 주소로 READ ENABLE을 보내서 데이터를 가져온다. 레지스터 A에 저장한다.

하나의 명령어가 완성되었다. 모든 회로를 끄고 다음 명령어를 FETCH할 준비를 한다. 명령어 주소 레지스터를 1증가시키는 것으로 실행 단계를 종료한다.


디코드 회로는 CONTROL UNIT으로 추상화 하자. 컨트롤 유닛은 CPU의 지휘자와 같이 모든 파트를 지휘한다. 필요한 레지스터를 선택해서 입력을 주고, ALU를 설정해서 올바른 연산을 하도록 한다. 결과값은 컨트롤 유닛의 내부 레지스터에 저장하고, ALU를 끄고, 적합한 레지스터에 결과를 저장한다.

CLOCK이라는 부품은 정확하게 주기적 전기 신호를 발생시킨다. 컨트롤 유닛이 내부 연산을 진행하는데 필요하다. CPU가 FETCH-DECODE-EXECUTE 한 사이클을 하는데 걸리는 시간을 CLOCK SPEED라고 한다. 이는 헤르츠로 잰다. 1헤르츠는 1초에 1사이클이라는 말이다.

1971년 출시한 최초의 CPU인 인텔 4004는 740KhZ였다. 1초에 74만 사이클을 수행하는 것이다. 지금은 기가헤르츠로 작동한다. 1초에 수십억 사이클을 수행하는 것이다.

컴퓨터를 오버클럭하면 CPU 속도를 높일 수 있다. 언더클럭하면 배터리를 덜쓸 수 있다. 자기가 알아서 클럭스피드를 조절하는 것을 DYNAMIC FREQUENCY SCALING이라고 한다.

### CPU의 강점
프로그래밍으로 조절 가능하다는 것(programmable)   

CPU는 수정이 용이한 소프트웨어로 작동시키는 하드웨어다.

프로그램은 마지막에 프로세스를 멈추도록 HALT 명령어를 필수로 줘야한다. 그렇지 않으면 CPU는 계속 0을 읽어서 수행한다. 그리고 HALT 명령어가 있어야지 명령어와 데이터를 구분할 수 있다. 명령어와 데이터는 모두 메모리에 저장되고 둘 다 이진수로 되어있기 때문에 이를 구분하게 해주는 HALT는 아주 중요하다.

인텔 4004는 46개의 명령어를 지원했다. 요즘 i7같은 프로세서는 수천개의 명령어가 있다.

### CPU 성능 개선: 캐쉬
트랜지스터를 개량하고 복잡한 회로로 CPU는 더 다양한 동작을 빠르게 수행하게 되었다. RAM과 CPU가 서로 데이터를 주고받는 BUS에서 속도가 느려지는 병목 현상이 일어나, 프로세서는 데이터가 올 때까지 기다리는 일이 생겼다. 그래서 CPU에 캐쉬라는 작은 램 메모리를 넣었다. 그래서 RAM에서 데이터를 가져올 때 1개의 데이터만 가져오는게 아니라 그 데이터 블록 전체를 다 가져와 CACHE에 저장한다. 컴퓨터 데이터는 순차적으로 되어있는게 많아서 아주 유용했다.   

CPU가 요청하는 데이터가 캐쉬에 있는 경우를 캐쉬 힛이라고 한다. 캐쉬 미스가 나면 램까지 가야한다. 캐쉬는 연산 도중에 값을 임시로 저장하는데 쓰이기도 한다.

캐쉬에 저장된 메모리가 램 메모리 내용에서 변경될 수 있다. 이를 저장해둬야지 동기화시킬 수 있다. 캐쉬의 각 비트에는 DIRTY BIT이라는 플래그가 있다. 
동기화는 캐쉬가 꽉찼고 프로세서가 메모리 블럭을 요청할때 주로 하게된다. 캐쉬는 데이터를 지우기전에 더티빗을 확인해서 더티하면 RAM에 저장한다.

### CPU 성능 개선: 명령어 파이프라인

명령어 파이프라이닝으로 CPU성능을 올릴 수도 있다. 작업을 병렬로 처리하는 것이다. 하나의 TASK가 끝나기 전에 다른 TASK를 시작해서 동시에 동작하도록 한다. FETCH-DECODE-EXECUTE는 각기 다른 부품이 맡기 때문에 이를 병렬로 처리하는 것이다. 
문제점은 데이터가 지금 수정중인데 그걸 FETCH하면 수정전의 데이터를 갖게 된다. 이를 해결하기 위해서 데이터 의존성을 파악해서 파이프라인을 지연시킨다.
또는 의존성을 가진 명령어 순서를 바꿔서 지연없이 파이프라인이 진행되도록 하기도 한다.  

### CPU 성능 개선: 멀티코어
멀티코어 프로세서로 CPU속도를 늘리기도 하였다. 하나의 CPU에 독립된 명령어 프로세서가 들어있는 것이다.
하나의 컴퓨터에 여러 CPU를 달 수도 있다.   

슈퍼컴퓨터는 프로세서를 엄청 많이 다는 것이다. 4만개가 넘는 CPU를 단 컴퓨터가 있었단다.   


출처: 크래쉬코스 컴퓨터과학 특강 7, 8, 9